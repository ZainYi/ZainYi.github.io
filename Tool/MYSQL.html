<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL 36 条军规 | Zain Yi</title>
    <meta name="description" content="TO BE A CRACKER">
    <link rel="icon" href="/zain.png">
    
    <link rel="preload" href="/assets/css/0.styles.b40796a8.css" as="style"><link rel="preload" href="/assets/js/app.ac5f1340.js" as="script"><link rel="preload" href="/assets/js/34.b0a984fc.js" as="script"><link rel="prefetch" href="/assets/js/2.a85795b1.js"><link rel="prefetch" href="/assets/js/3.62ae61e3.js"><link rel="prefetch" href="/assets/js/4.d49f1fb7.js"><link rel="prefetch" href="/assets/js/5.a3fab095.js"><link rel="prefetch" href="/assets/js/6.a8b4a36b.js"><link rel="prefetch" href="/assets/js/7.d7707cfa.js"><link rel="prefetch" href="/assets/js/8.b281fb3a.js"><link rel="prefetch" href="/assets/js/9.b38ddefd.js"><link rel="prefetch" href="/assets/js/10.3e4d325b.js"><link rel="prefetch" href="/assets/js/11.93b41b91.js"><link rel="prefetch" href="/assets/js/12.5a03db1e.js"><link rel="prefetch" href="/assets/js/13.4adfde32.js"><link rel="prefetch" href="/assets/js/14.1a520845.js"><link rel="prefetch" href="/assets/js/15.0aace896.js"><link rel="prefetch" href="/assets/js/16.f6ddf6ab.js"><link rel="prefetch" href="/assets/js/17.1fd21dd6.js"><link rel="prefetch" href="/assets/js/18.edbcb9b9.js"><link rel="prefetch" href="/assets/js/19.41d5bf6f.js"><link rel="prefetch" href="/assets/js/20.3c6ac27e.js"><link rel="prefetch" href="/assets/js/21.48188a46.js"><link rel="prefetch" href="/assets/js/22.fac4b07e.js"><link rel="prefetch" href="/assets/js/23.13e7da9f.js"><link rel="prefetch" href="/assets/js/24.6a4639f9.js"><link rel="prefetch" href="/assets/js/25.9f27d2c0.js"><link rel="prefetch" href="/assets/js/26.b7014163.js"><link rel="prefetch" href="/assets/js/27.5fd2c57d.js"><link rel="prefetch" href="/assets/js/28.6ed5d425.js"><link rel="prefetch" href="/assets/js/29.673b8833.js"><link rel="prefetch" href="/assets/js/30.0c3bf845.js"><link rel="prefetch" href="/assets/js/31.acd8dcb2.js"><link rel="prefetch" href="/assets/js/32.12b1b7d4.js"><link rel="prefetch" href="/assets/js/33.7b731028.js"><link rel="prefetch" href="/assets/js/35.33cbd931.js"><link rel="prefetch" href="/assets/js/36.052ca880.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b40796a8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zain Yi</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/ECMAScript/" class="nav-link">ECMAScript</a></div><div class="nav-item"><a href="/CSS3HTML5/" class="nav-link">CSS3&amp;HTML5</a></div><div class="nav-item"><a href="/Node/" class="nav-link">Node</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">服务端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Server/Java/" class="nav-link">Java 开发</a></li><li class="dropdown-item"><!----> <a href="/Server/Python/" class="nav-link">Python 爬虫</a></li></ul></div></div><div class="nav-item"><a href="/Tool/" class="nav-link router-link-active">Tool</a></div><div class="nav-item"><a href="/HTTP/" class="nav-link">HTTP</a></div><div class="nav-item"><a href="/About/" class="nav-link">博主</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/ECMAScript/" class="nav-link">ECMAScript</a></div><div class="nav-item"><a href="/CSS3HTML5/" class="nav-link">CSS3&amp;HTML5</a></div><div class="nav-item"><a href="/Node/" class="nav-link">Node</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">服务端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Server/Java/" class="nav-link">Java 开发</a></li><li class="dropdown-item"><!----> <a href="/Server/Python/" class="nav-link">Python 爬虫</a></li></ul></div></div><div class="nav-item"><a href="/Tool/" class="nav-link router-link-active">Tool</a></div><div class="nav-item"><a href="/HTTP/" class="nav-link">HTTP</a></div><div class="nav-item"><a href="/About/" class="nav-link">博主</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>MySQL 36 条军规</span> <!----></p> <ul class="sidebar-group-items"></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="mysql-36-条军规"><a href="#mysql-36-条军规" aria-hidden="true" class="header-anchor">#</a> MySQL 36 条军规</h1> <div class="language- extra-class"><pre class="language-text"><code>写在前面的话：
总是在灾难发生后，才想起容灾的重要性；
总是在吃过亏后，才记得曾经有人提醒过。

一. 核心军规

1. 不在数据库做运算
    cpu计算务必移至业务层

2. 控制单表数据量
    int型不超过1000w，含char则不超过500w
    合理分表
    限制单库表数量在300以内

3. 控制列数量
    字段少而精，字段数建议在20以内

4. 平衡范式与冗余
    效率优先
    往往牺牲范式

5. 拒绝3B
    拒绝大sql语句：big sql
    拒绝大事物：big transaction
    拒绝大批量：big batch

二. 字段类军规

6. 用好数值类型
    tinyint(1Byte)
    smallint(2Byte)
    mediumint(3Byte)
    int(4Byte)
    bigint(8Byte)
    bad case：int(1)/int(11)

7. 字符转化为数字
    用int而不是char(15)存储ip

8. 优先使用enum或set
    例如：`sex` enum (‘F’, ‘M’)

9. 避免使用NULL字段
    NULL字段很难查询优化
    NULL字段的索引需要额外空间
    NULL字段的复合索引无效
    bad case：
    `name` char(32) default null
    `age` int not null
    good case：
    `age` int not null default 0

10. 少用text/blob
    varchar的性能会比text高很多
    实在避免不了blob，请拆表

11. 不在数据库里存图片数据
    而是存图片地址

三. 索引类军规

12. 谨慎合理使用索引
    改善查询、减慢更新
    索引一定不是越多越好(能不加就不加，要加的一定得加)
    覆盖记录条数过多不适合建索引，例如“性别”

13. 字符字段必须建前缀索引

14. 不在索引做列运算
    不只是索引，尽量不能做列运算吧
    bad case：
    select id where age +1 = 10

15. innodb主键推荐使用自增列
    主键建立聚簇索引
    主键不应该被修改
    字符串不应该做主键
    如果不指定主键，innodb会使用唯一且非空值索引代替

16. 不用外键
    请由程序保证约束

四. sql类军规

17. sql语句尽可能简单
    一条sql只能在一个cpu运算
    大语句拆小语句，减少锁时间
    一条大sql可以堵死整个库

18. 简单的事务
    事务时间尽可能短
    bad case
    上传图片事务

19. 避免使用trig/func
    触发器、函数不用
    客户端程序取而代之

20. 不用select *
    消耗cpu，io，内存，带宽
    这种程序不具有扩展性

21. OR改写为IN()
    or的效率是n级别
    in的消息时log(n)级别
    in的个数建议控制在200以内
        select id from t where phone=’159′ or phone=’136′;
        =&gt;
        select id from t where phone in (’159′, ’136′);

22. OR改写为UNION
    mysql的索引合并很弱智
        select id from t where phone = ’159′ or name = ‘john’;
        =&gt;
        select id from t where phone=’159′
        union
        select id from t where name=’jonh’

23. 避免负向%

24. 慎用count(*)

25. 同上

26. limit高效分页
    limit越大，效率越低
    select id from t limit 10000, 10;
    =&gt;
    select id from t where id &gt; 10000 limit 10;

27. 使用union all替代union
    union有去重开销

28. 少用连接join

29. 使用group by
    分组
    自动排序

30. 请使用同类型比较

31. 使用load data导数据
    load data比insert快约20倍

32. 打散批量更新

33. 新能分析工具
    show profile;
    mysqlsla;
    mysqldumpslow;
    explain;
    show slow log;
    show processlist;
    show query_response_time(percona);
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/34.b0a984fc.js" defer></script><script src="/assets/js/app.ac5f1340.js" defer></script>
  </body>
</html>
